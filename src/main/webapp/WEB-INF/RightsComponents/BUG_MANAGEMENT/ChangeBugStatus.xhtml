<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://xmlns.jcp.org/jsf/core"
        xmlns:h="http://xmlns.jcp.org/jsf/html"
        xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
        xmlns:p="http://primefaces.org/ui">
    <f:view>
        <p:growl id="editStatusBugGrowl" showDetail="true" sticky="false"/>
        <h:form id="searchBugAfterUser">
            <h:outputText value="#{msg['EnterAssignedUsernameToFindTheBug']}" styleClass="myFont"/>
            <h:inputText id="assignedToUser" value="#{updateBugStatusBackingBean.usernameAssignedToChangeStatus}" required="true"
                         label="#{msg['AssignedTo']}"/>
            <br/>
            <p:commandButton value="#{msg['Search']}" action="#{updateBugStatusBackingBean.searchUsername}"
                             ajax="true"
                             update="listUserBugs"
                             styleClass="aButton"/>
        </h:form>
        <br/>

        <h:form id="listUserBugs">
            <p:dataTable id="updateBug" var="bug" value="#{updateBugStatusBackingBean.bugsAssignedToUser}"
                         selectionMode="single"
                         rowKey="#{bug.id}"
                         editable="true" editMode="cell"
                         style="margin-bottom:20px" emptyMessage="#{msg['NoRecordsFound']}">

                <p:ajax event="cellEdit" listener="#{updateBugStatusBackingBean.onCellEdit}" update="editStatusBugGrowl"/>

                <p:column headerText="#{msg['Title']}">
                    <h:outputText value="#{bug.title}"/>
                </p:column>
                <p:column headerText="Status">
                    <p:cellEditor>
                        <f:facet name="output"><h:outputText value="#{bug.status}"/>
                        </f:facet>
                        <f:facet name="input">
                            <h:selectOneMenu value="#{updateBugStatusBackingBean.myStatus}" style="width:100%">
                                <f:selectItem itemLabel="new" itemValue="new" itemDisabled="#{updateBugStatusBackingBean.acceptsStatusNew(bug.status)}"/>
                                <f:selectItem itemLabel="in_progress" itemValue="in_progress" itemDisabled="#{updateBugStatusBackingBean.acceptsStatusInProgress(bug.status)}"/>
                                <f:selectItem itemLabel="info_needed" itemValue="info_needed" itemDisabled="#{updateBugStatusBackingBean.acceptsStatusInfoNeeded(bug.status)}"/>
                                <f:selectItem itemLabel="fixed" itemValue="fixed" itemDisabled="#{updateBugStatusBackingBean.acceptsStatusFixed(bug.status)}"/>
                                <f:selectItem itemLabel="rejected" itemValue="rejected" itemDisabled="#{updateBugStatusBackingBean.acceptsStatusRejected(bug.status)}"/>
                            </h:selectOneMenu>
                        </f:facet>
                    </p:cellEditor>
                </p:column>

                <p:contextMenu for="updateBug" widgetVar="cMenu">
                    <p:menuitem value="Edit Cell" icon="ui-icon-search" onclick="PF('cellBugs').showCellEditor();return false;"/>
                    <p:menuitem value="Hide Menu" icon="ui-icon-close" onclick="PF('cMenu').hide()"/>
                </p:contextMenu>

            </p:dataTable>
        </h:form>
    </f:view>
</ui:composition>